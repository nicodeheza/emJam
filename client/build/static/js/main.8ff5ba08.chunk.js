(this["webpackJsonpmusical-chat"]=this["webpackJsonpmusical-chat"]||[]).push([[0],{33:function(e,t,n){},38:function(e,t,n){},39:function(e,t,n){},40:function(e,t,n){},41:function(e,t,n){},42:function(e,t,n){},43:function(e,t,n){},45:function(e,t,n){},46:function(e,t,n){},49:function(e,t,n){"use strict";n.r(t);var c=n(1),s=n.n(c),a=n(14),r=n.n(a),i=(n(33),n(18)),o=n(4),l=n(24),u=n(5),j="CREATE_AUDIO_CONTEXT",d="CREATE_MAIN_GAIN",h="CREATE_WAVE",b="PLAY_NOTE",v="STOP_NOTE",f="PLAY_DRUM",m="DELETE_DRUM",O="CONNECT",x="UPDATE_CONNECTION_STATE",g="SET_ROOM",p="ADD_USER",w="DELETE_USER",y="DELETE_WAVE",C="CREATE_DRUMS_BUFFERS",S="RESET_CHAT",V="RESET_WAVES",N=window.AudioContext||window.webkitAudioContext,E=["rgb(255,0,0)","rgb(0,255,0)","rgb(0,0,255)","rgb(255,255,0)","rgb(0,255,255)"],k=0,M=function(e){return function(t,n){var c=n().audioCtx,s=c.audioCtx,a=c.masterGain,r={};r.analyser=s.createAnalyser(),r.analyser.connect(a),r.analyser.fftSize=2048;var i=r.analyser.frequencyBinCount;r.bufferLength=i,r.dataArr=new Uint8Array(i),r.color=E[k],k++,k%=5,t({type:h,payload:{userId:e,wave:r}})}},T=n(6),A=n(0);function G(e){var t=e.classN;return Object(A.jsxs)("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",xmlnsa:"http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/",viewBox:"0 0 68.1 71.5",className:t,children:[Object(A.jsx)("defs",{}),Object(A.jsx)("path",{d:"M66.6,45.9c0-0.8-0.4-1.5-1.1-1.9l-6.2-3.6c0.3-1.5,0.4-3.2,0.4-4.7c0-1.5-0.2-3.2-0.4-4.7l6.2-3.6\r c0.7-0.4,1.1-1.1,1.1-1.9c0-1.9-5.6-13.2-8.5-13.2c-0.4,0-0.8,0.1-1.1,0.3l-6.2,3.6c-2.4-2-5.1-3.6-8.1-4.7V4.4c0-1-0.7-1.9-1.7-2.1\r c-2.2-0.5-4.5-0.7-6.9-0.7s-4.7,0.3-6.9,0.7c-1,0.2-1.7,1.1-1.7,2.1v7.2c-3,1.1-5.7,2.7-8.1,4.7l-6.3-3.6c-0.3-0.2-0.7-0.3-1.1-0.3\r c-2.6,0-8.5,11-8.5,13.2c0,0.8,0.4,1.5,1.1,1.9l6.2,3.6c-0.3,1.5-0.4,3.1-0.4,4.7s0.2,3.2,0.4,4.7L2.6,44c-0.7,0.4-1.1,1.1-1.1,1.9\r c0,1.9,5.6,13.2,8.5,13.2c0.4,0,0.8-0.1,1.1-0.3l6.2-3.6c2.4,2,5.1,3.6,8.1,4.7v7.2c0,1,0.7,1.9,1.7,2.1c2.2,0.5,4.5,0.7,6.8,0.7\r s4.7-0.3,6.9-0.7c1.1-0.3,1.8-1.1,1.8-2.1v-7.2c3-1.1,5.7-2.7,8.1-4.7l6.2,3.6c0.3,0.2,0.7,0.3,1.1,0.3\r C60.7,59.1,66.6,48.2,66.6,45.9z M34.1,46.4c-5.9,0-10.7-4.8-10.7-10.7S28.2,25,34.1,25s10.7,4.8,10.7,10.7S40,46.4,34.1,46.4z"})]})}function L(e){var t=e.classN;e.percent;return Object(A.jsxs)("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",xmlnsa:"http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/",viewBox:"0 0 70.7 51.7",className:t,children:[Object(A.jsx)("defs",{}),Object(A.jsxs)("g",{children:[Object(A.jsx)("g",{children:Object(A.jsx)("path",{d:"M37.7,7.2v37.3c0,1.8-1.5,3.3-3.3,3.3L17.6,37.1H4.4c-1.6,0-2.9-1.3-2.9-2.9V17.5c0-1.6,1.3-2.9,2.9-2.9h13.2\r L34.4,3.9C36.2,3.9,37.7,5.4,37.7,7.2z"})}),Object(A.jsx)("g",{children:Object(A.jsx)("path",{d:"M47.1,40.8c-0.5,0-0.9-0.2-1.3-0.5c-0.7-0.7-0.7-1.8,0-2.6c3.1-3.1,4.8-7.3,4.8-11.7c0-4.5-1.8-8.8-5-12\r c-0.7-0.7-0.7-1.8,0-2.6c0.7-0.7,1.8-0.7,2.6,0c4,3.9,6.1,9,6.1,14.6c0,5.4-2.1,10.4-5.8,14.3C48,40.6,47.5,40.8,47.1,40.8z"})}),Object(A.jsx)("g",{children:Object(A.jsx)("path",{d:"M52.3,46.1c-0.5,0-0.9-0.2-1.3-0.5c-0.7-0.7-0.7-1.9,0-2.6c4.5-4.6,7-10.6,7-17c0-6.5-2.6-12.7-7.2-17.2\r c-0.7-0.7-0.7-1.8,0-2.6c0.7-0.7,1.8-0.7,2.6,0c5.4,5.3,8.3,12.3,8.3,19.8c0,7.4-2.9,14.3-8.1,19.6C53.2,45.9,52.8,46.1,52.3,46.1\r z"})}),Object(A.jsx)("g",{children:Object(A.jsx)("path",{d:"M58.3,50.7c-0.5,0-0.9-0.2-1.3-0.5c-0.7-0.7-0.7-1.9,0-2.6c5.8-5.8,9-13.5,9-21.7c0-8.2-3.2-15.9-9-21.7\r c-0.7-0.7-0.7-1.9,0-2.6c0.7-0.7,1.9-0.7,2.6,0C66.1,8,69.7,16.6,69.7,25.8c0,9.2-3.6,17.8-10.1,24.3\r C59.2,50.5,58.8,50.7,58.3,50.7z"})}),Object(A.jsx)("g",{children:Object(A.jsx)("path",{d:"M66.1,25.8"})})]})]})}function I(e){var t=e.classN;return Object(A.jsxs)("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",xmlnsa:"http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/",viewBox:"0 0 19 38.8",className:t,children:[Object(A.jsx)("defs",{}),Object(A.jsxs)("g",{children:[Object(A.jsx)("path",{d:"M9.5,14.3L9.5,14.3c5.2,0,9.5,4.3,9.5,9.5v15H0v-15C0,18.5,4.3,14.3,9.5,14.3z"}),Object(A.jsx)("circle",{cx:"9.5",cy:"6.8",r:"6.8"})]})]})}function z(e){var t=e.classN;return Object(A.jsxs)("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",xmlnsa:"http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/",viewBox:"0 0 126.2 64.3",className:t,children:[Object(A.jsx)("defs",{}),Object(A.jsxs)("g",{children:[Object(A.jsx)("g",{children:Object(A.jsx)("path",{d:"M117.7,0H8.5C3.8,0,0,3.8,0,8.5v47.3c0,4.7,3.8,8.5,8.5,8.5h109.2c4.7,0,8.5-3.8,8.5-8.5V8.5\r C126.2,3.8,122.4,0,117.7,0z M100.5,18.1c0-0.8,0.7-1.5,1.5-1.5h0.3V7.4h1.4v9.2h0.5c0.8,0,1.5,0.7,1.5,1.5v2.2\r c0,0.8-0.7,1.5-1.5,1.5h-0.5V27h-1.4v-5.2H102c-0.8,0-1.5-0.7-1.5-1.5V18.1z M89.8,10.6c0-0.8,0.7-1.5,1.5-1.5h0.4V7.4h1.4v1.7\r h0.4c0.8,0,1.5,0.7,1.5,1.5v2.2c0,0.8-0.7,1.5-1.5,1.5h-0.4V27h-1.4V14.3h-0.4c-0.8,0-1.5-0.7-1.5-1.5V10.6z M22.5,15.5\r c0-1.7,1.3-3,3-3h3.2c1.7,0,3,1.3,3,3v3.2c0,1.7-1.3,3-3,3h-3.2c-1.7,0-3-1.3-3-3V15.5z M9.7,15.5c0-1.7,1.3-3,3-3h3.2\r c1.7,0,3,1.3,3,3v3.2c0,1.7-1.3,3-3,3h-3.2c-1.7,0-3-1.3-3-3V15.5z M13.5,59.7h-5c-2.2,0-3.9-1.7-3.9-3.9V34.5c0.1,0,0.2,0,0.3,0\r h6.4v13.3c0,0.6,0.5,1.1,1.1,1.1h1.1V59.7z M25.7,59.7H15.2V48.9h1.1c0.6,0,1.1-0.5,1.1-1.1V34.5h6.1v13.3c0,0.6,0.5,1.1,1.1,1.1\r h1.1V59.7z M37.9,59.7H27.3V48.9h1.1c0.6,0,1.1-0.5,1.1-1.1V34.5h8.3V59.7z M35.3,18.8v-3.2c0-1.7,1.3-3,3-3h3.2c1.7,0,3,1.3,3,3\r v3.2c0,1.7-1.3,3-3,3h-3.2C36.7,21.8,35.3,20.4,35.3,18.8z M50,59.7H39.5V34.5h8.3v13.3c0,0.6,0.5,1.1,1.1,1.1H50V59.7z\r M62.2,59.7H51.7V48.9h1.1c0.6,0,1.1-0.5,1.1-1.1V34.5H60v13.3c0,0.6,0.5,1.1,1.1,1.1h1.1V59.7z M74.4,59.7H63.9V48.9H65\r c0.6,0,1.1-0.5,1.1-1.1V34.5h8.3V59.7z M86.6,59.7H76V34.5h8.3v13.3c0,0.6,0.5,1.1,1.1,1.1h1.1V59.7z M98.7,59.7H88.2V48.9h1.1\r c0.6,0,1.1-0.5,1.1-1.1V34.5h6.1v13.3c0,0.6,0.5,1.1,1.1,1.1h1.1V59.7z M110.9,59.7h-10.5V48.9h1.1c0.6,0,1.1-0.5,1.1-1.1V34.5\r h8.3V59.7z M111.2,14.2V12c0-0.8,0.7-1.5,1.5-1.5h0.3V7.4h1.4v3.2h0.5c0.8,0,1.5,0.7,1.5,1.5v2.2c0,0.8-0.7,1.5-1.5,1.5h-0.5V27\r H113V15.7h-0.3C111.9,15.7,111.2,15.1,111.2,14.2z M121.6,55.8c0,2.2-1.7,3.9-3.9,3.9h-5.1V34.5h9V55.8z"})}),Object(A.jsx)("path",{d:"M17.2,15.5v3.2c0,0.7-0.6,1.3-1.3,1.3h-3.2c-0.7,0-1.3-0.6-1.3-1.3v-3.2c0-0.7,0.6-1.3,1.3-1.3h3.2\r C16.6,14.3,17.2,14.8,17.2,15.5z"}),Object(A.jsx)("path",{d:"M30,15.5v3.2c0,0.7-0.6,1.3-1.3,1.3h-3.2c-0.7,0-1.3-0.6-1.3-1.3v-3.2c0-0.7,0.6-1.3,1.3-1.3h3.2\r C29.4,14.3,30,14.8,30,15.5z"}),Object(A.jsx)("path",{d:"M42.8,15.5v3.2c0,0.7-0.6,1.3-1.3,1.3h-3.2c-0.7,0-1.3-0.6-1.3-1.3v-3.2c0-0.7,0.6-1.3,1.3-1.3h3.2\r C42.3,14.3,42.8,14.8,42.8,15.5z"})]})]})}function F(e){var t=e.classN;return Object(A.jsxs)("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",xmlnsa:"http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/",viewBox:"0 0 95.7 81.4",className:t,children:[Object(A.jsx)("defs",{}),Object(A.jsxs)("g",{children:[Object(A.jsx)("path",{d:"M18.7,51.7V79C8.4,75.9,1.3,70.2,1.1,64.7L0.5,39.4C0.5,39.4,2.7,48,18.7,51.7z"}),Object(A.jsx)("path",{d:"M46.1,52.6v27.7c-3.4,0.6-7,1-10.8,1c-3.5,0-6.9-0.3-10.1-0.8V52.8c3,0.3,6.2,0.5,9.9,0.5\r C39.3,53.4,42.9,53.1,46.1,52.6z"}),Object(A.jsx)("path",{d:"M70.1,38.3V63c-0.7,6.5-7.6,12.4-17.5,15.7V51.3C67.9,47.2,70.1,38.3,70.1,38.3z"}),Object(A.jsx)("path",{d:"M85.1,4.1L50.3,18.7c4.5,1,8.4,2.4,11.6,4.1L58,24c-3.5-1.5-7.7-2.6-12.4-3.3l-8.4,3.5c-1.1,0.5-2.2,0.5-2.4,0\r L34.6,24c-0.2-0.5,0.5-1.3,1.6-1.8l47.1-22c1-0.4,2.1,0,2.6,1l0.2,0.4C86.5,2.5,86.1,3.6,85.1,4.1z"}),Object(A.jsx)("path",{d:"M94,26.2L69,29c0.9,1.4,1.3,3,1.3,4.6c0,9.2-15.5,16.5-35.2,16.5S0,42.9,0,33.6s15.5-16.5,35.2-16.5\r c1,0,2.1,0,3.1,0.1l-4.2,2.7C17,20.2,2.8,26.4,2.8,33.6c0,7.4,14.8,13.7,32.4,13.7s32.4-6.3,32.4-13.7c0-1.5-0.6-2.9-1.7-4.2\r l-23.6,2.7c-1.2,0.2-2.3-0.2-2.3-0.7l0-0.2c-0.1-0.6,0.8-1.1,2.1-1.3l20.9-3.2c0,0,0,0,0,0l3.7-0.6c0,0,0,0,0,0l26.9-4.2\r c1.1-0.1,2,0.6,2.2,1.7l0.1,0.4C95.9,25,95.1,26,94,26.2z"})]})]})}n(38);function R(e){var t=e.mainVolumen,n=e.setMainVolumen,s=e.drumsSelected,a=e.setDrumsSelected,r=e.setShowSettings,i=Object(c.useState)(!1),o=Object(u.a)(i,2),l=o[0],j=o[1],d=Object(T.c)((function(e){return e.chat.users.length+1}));return Object(A.jsxs)("nav",{className:"toolbarMainContainer",children:[Object(A.jsxs)("div",{className:"toolsContainer settingsBtnContainer",children:[Object(A.jsx)("button",{id:"setBtn",onClick:function(){return r((function(e){return!e})),void j(!0)},onAnimationEnd:function(){return j(!1)},className:l?"stAnimation":"",children:Object(A.jsx)(G,{classN:"settingsIcon"})}),Object(A.jsx)("label",{htmlFor:"setBtn",className:"toolsLabel",children:"Instrument Settings"})]}),Object(A.jsxs)("div",{className:"toolsContainer",children:[Object(A.jsxs)("div",{className:"rangeVolumenContainer",children:[Object(A.jsx)("input",{type:"range",name:"main-volumen",id:"main-volumen",min:"0",max:"100",value:t,onChange:function(e){return n(parseFloat(e.target.value))}}),Object(A.jsx)(L,{classN:"volumenIcon"})]}),Object(A.jsx)("label",{htmlFor:"main-volumen",className:"toolsLabel",children:"Master Volumen"})]}),Object(A.jsxs)("div",{className:"connectedUsersMainContainer toolsContainer",children:[Object(A.jsxs)("div",{id:"connected-users",className:"connectedUsersContainer",children:[Object(A.jsx)(I,{classN:"userIcon"}),Object(A.jsx)("p",{children:d+"/5"})]}),Object(A.jsx)("label",{htmlFor:"connected-users",className:"toolsLabel",children:"Users Connected"})]}),Object(A.jsxs)("div",{className:"toolsContainer",children:[Object(A.jsxs)("div",{id:"instrument-picker",className:"instrumentMainContainer",children:[Object(A.jsx)("button",{className:"instrumentBtn",onClick:function(){return a(!1)},children:Object(A.jsx)(z,{classN:s?"pianoIcon instrumentOff":"pianoIcon"})}),Object(A.jsx)("button",{className:"instrumentBtn",onClick:function(){return a(!0)},children:Object(A.jsx)(F,{classN:s?"drumsIcon":"drumsIcon instrumentOff"})})]}),Object(A.jsx)("label",{htmlFor:"instrument-picker",className:"toolsLabel",children:"Instrument"})]})]})}var q=n(2),B=(n(39),"DISCONNECTED"),D="FAIL",X="CONNECTED",H=n(17),P=n(25),_=function(){function e(t,n,c,s,a,r,i,o,l,u){var j=this;Object(H.a)(this,e),this.freq=t,this.oscTotal=c+s+a+r,this.oscData=[{type:"sine",gain:c/this.oscTotal},{type:"square",gain:s/this.oscTotal},{type:"sawtooth",gain:a/this.oscTotal},{type:"triangle",gain:r/this.oscTotal}],this.audioCtx=l,this.instrumentGain=this.audioCtx.createGain(),this.instrumentGain.gain.setValueAtTime(u/100,0),this.instrumentGain.connect(n),this.sustainGain=this.audioCtx.createGain(),this.sustain(),this.vibrato=this.audioCtx.createOscillator(),this.vibrato.frequency.value=o,this.vibratoGain=this.audioCtx.createGain(),this.vibratoGain.gain.value=i,this.vibrato.connect(this.vibratoGain),this.oscillators=[],this.oscData.forEach((function(e){if(e.gain>0){var t=j.audioCtx.createOscillator();t.frequency.setValueAtTime(j.freq,j.audioCtx.currentTime),t.type=e.type;var n=j.audioCtx.createGain();n.gain.setValueAtTime(e.gain,j.audioCtx.currentTime),j.vibratoGain.connect(t.frequency),t.connect(n),n.connect(j.sustainGain),j.oscillators.push(t)}})),this.play()}return Object(P.a)(e,[{key:"sustain",value:function(){var e=this.audioCtx.currentTime;this.sustainGain.gain.setValueAtTime(0,e),this.sustainGain.gain.linearRampToValueAtTime(1,e+.2),this.sustainGain.gain.linearRampToValueAtTime(.7,e+.2+.3),this.sustainGain.connect(this.instrumentGain)}},{key:"play",value:function(){this.vibrato.start(),this.oscillators.forEach((function(e){e.start()}))}},{key:"stop",value:function(){var e=this.audioCtx.currentTime+.2;this.sustainGain.gain.linearRampToValueAtTime(0,e),this.oscillators.forEach((function(t){t.stop(e)})),this.vibrato.stop(e)}}]),e}(),U=function e(t,n,c,s){Object(H.a)(this,e);var a=c.createBufferSource();a.buffer=t;var r=c.createGain();r.gain.setValueAtTime(s/100*4,0),a.connect(r),r.connect(n),a.start()},W=function(e,t,n,c,s,a,r,i,o,l){return function(u,j){var d=j().waves[l].analyser,h=j().audioCtx.audioCtx,v=j().notes;if(!v[e]||void 0===v[e]){var f=new _(t,d,n,c,s,a,r,i,h,o);u({type:b,payload:{noteId:e,note:f}})}}},J=function(e){return function(t,n){var c=n().notes;void 0!==c[e]&&c[e]&&(c[e].stop(),delete c[e],t({type:v,payload:c}))}},K=function(e,t,n,c){return function(s,a){var r=a().waves[c].analyser,i=a().audioCtx.audioCtx,o=a().drumsBuffer,l=a().notes;if(!l[e]||void 0===l[e]){var u=new U(o[t],r,i,n);s({type:f,payload:{drumId:e,drum:u}})}}},Y=function(e){return function(t,n){var c=n().notes;c[e]&&void 0!==c[e]&&(delete c[e],t({type:m,payload:c}))}};n(40);function Q(e){var t=e.i,n=e.char,s=e.keysPressed,a=e.drumsSelected,r=e.instrumentSettings,i=Object(T.b)(),o=Object(c.useState)(!1),l=Object(u.a)(o,2),j=l[0],d=l[1],h=Object(c.useState)(!1),b=Object(u.a)(h,2),v=b[0],f=b[1],m=Object(c.useState)(!1),O=Object(u.a)(m,2),x=O[0],g=O[1],p=t+1;Object(c.useEffect)((function(){v||d(s.includes(n))}),[s,n,v]);var w=Object(T.c)((function(e){return e.chat})),y=w.room,C=w.ws,S=Object(T.c)((function(e){return e.chat.connectionState})),V=Object(c.useCallback)((function(e,t,n,c,s,a,r,i,o){var l={room:y,message:{freq:e,sine:t,square:n,sawtooth:c,triangle:s,vibratoGain:a,vibratoFrequency:r,instrumentVolume:i,isPlaying:o}},u=JSON.stringify(l);S===X&&C.send(u)}),[y,C,S]),N=Object(c.useCallback)((function(e,t,n){var c={room:y,message:{drumpBuffersIndex:e,instrumentVolume:t,isPlaying:n}},s=JSON.stringify(c);S===X&&C.send(s)}),[y,C,S]);return Object(c.useEffect)((function(){var e=t+28,c=440*Math.pow(Math.pow(2,1/12),e-49),s="local"+n,o=r.sine,l=r.square,u=r.triangle,d=r.sawtooth,h=r.vibratoGain,b=r.vibratoFreq,v=r.volume;if(a||!j||x)if(a||j||!x){if(a&&j&&!x){i(K("local"+n,t,r.volume,"local")),g(!0),N(t,v,!0)}else if(a&&!j&&x){i(Y("local"+n)),g(!1),N(t,v,!1)}}else{i(J("local"+n)),g(!1),V(c,o,l,d,u,h,b,v,!1)}else i(W(s,c,o,l,d,u,h,b,v,"local")),g(!0),V(c,o,l,d,u,h,b,v,!0)}),[j,a,r,n,t,x,i,V,N]),Object(A.jsxs)("button",{className:p%12===0||p%12===1||p%12===3||p%12===5||p%12===6||p%12===8||p%12===10?"whiteKey":"blackKey",style:p%12!==0&&p%12!==1&&p%12!==3&&p%12!==5&&p%12!==6&&p%12!==8&&p%12!==10||!j?j?{backgroundColor:"#abd3ff"}:{}:{backgroundColor:"#97a6ff"},onMouseDown:function(){return f(!0),void d(!0)},onMouseUp:function(){return f(!1),void d(!1)},onMouseLeave:function(){v&&d(!1)},children:[t%12===0?Object(A.jsxs)("span",{className:"eighth",children:["C",t/12+1]}):null,Object(A.jsx)("span",{className:"keyName",children:n.toUpperCase()})]})}var Z="1234567890qwertyuiopasdfghjklzxcvbnm,.-".split("");function $(e){var t=e.keysPressed,n=e.drumsSelected,s=e.instrumentSettings,a=Object(c.useState)({isScrolling:!1,clientX:0,scrollX:0}),r=Object(u.a)(a,2),i=r[0],o=r[1],l=Object(c.useRef)(null);return Object(A.jsx)("div",{className:"mainKeyboardContainer",onMouseDown:function(e){return function(e){o({isScrolling:!0,clientX:e.clientX,scrollX:l.current.scrollLeft})}(e)},onMouseUp:function(e){o(Object(q.a)(Object(q.a)({},i),{},{isScrolling:!1}))},onMouseMove:function(e){return function(e){var t=i.clientX,n=i.scrollX;if(i.isScrolling){var c=n+-1*(e.clientX-t);l.current.scrollLeft=c,o(Object(q.a)(Object(q.a)({},i),{},{scrollX:c,clientX:e.clientX}))}}(e)},ref:l,children:Object(A.jsx)("div",{className:"keyboardContainer",children:Z.map((function(e,c){return Object(A.jsx)(Q,{i:c,char:e,keysPressed:t,drumsSelected:n,instrumentSettings:s},c)}))})})}function ee(e){var t=e.classN;return Object(A.jsxs)("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",xmlnsa:"http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/",viewBox:"0 0 106 15.9",className:t,children:[Object(A.jsx)("defs",{}),Object(A.jsx)("path",{d:"M1,7.9C3.6,4.5,6.2,1,9.7,1C16.6,1,20.1,14.9,27,14.9S37.4,1,44.4,1s10.4,13.9,17.3,13.9S72.1,1,79,1\r s10.4,13.9,17.3,13.9c3.5,0,6.1-3.5,8.7-6.9"})]})}function te(e){var t=e.classN;return Object(A.jsxs)("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",xmlnsa:"http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/",viewBox:"0 0 126 18.3",className:t,children:[Object(A.jsx)("defs",{}),Object(A.jsx)("path",{d:"M0.9,0.9h20.7v16.6h20.7V0.9H63v16.6h20.7V0.9h20.7v16.6h20.7"})]})}function ne(e){var t=e.classN;return Object(A.jsxs)("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",xmlnsa:"http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/",viewBox:"0 0 118 17.2",className:t,children:[Object(A.jsx)("defs",{}),Object(A.jsx)("path",{d:"M0.9,8.6l9.7-7.8l19.4,15.5L49.3,0.9l19.4,15.5L88.1,0.9l19.4,15.5l9.7-7.7"})]})}function ce(e){var t=e.classN;return Object(A.jsxs)("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",xmlnsa:"http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/",viewBox:"0 0 112.3 16.5",className:t,children:[Object(A.jsx)("defs",{}),Object(A.jsx)("path",{d:"M0.9,8.2l18.4-7.4v14.7L56.1,0.9v14.7L93,0.9v14.7l18.4-7.4"})]})}n(41);function se(e){var t=e.instrumentSettings,n=e.setInstrumentSettings,s=e.showSettings,a=e.drumsSelected,r=Object(c.useRef)(null),i=Object(c.useRef)(null),o=Object(c.useState)(1e4),l=Object(u.a)(o,2),j=l[0],d=l[1],h=Object(c.useState)({width:window.innerWidth,height:window.innerHeight}),b=Object(u.a)(h,2),v=b[0],f=b[1],m=function(){f({width:window.innerWidth,height:window.innerHeight})};return Object(c.useEffect)((function(){return window.addEventListener("resize",m),function(){window.removeEventListener("resize",m)}}),[]),Object(c.useEffect)((function(){var e=r.current.getBoundingClientRect().width;d(e)}),[v,a]),Object(c.useEffect)((function(){s?i.current.style.opacity="1":setTimeout((function(){i.current.style.opacity="0"}),1e3)}),[s]),Object(A.jsx)("div",{className:"settingsMainContainer",style:s?{transform:"translateX(0%)",transition:" transform 1s"}:{transform:"translateX(".concat(-1*(j+20),"px)"),transition:" transform 1s"},ref:i,children:Object(A.jsxs)("div",{className:"settingFlexContainer",ref:r,children:[a?null:Object(A.jsxs)(A.Fragment,{children:[Object(A.jsxs)("div",{className:"sliderCategory",children:[Object(A.jsx)("h5",{children:"Wave Settings"}),Object(A.jsxs)("div",{className:"sliderContainer",children:[Object(A.jsx)("input",{type:"range",name:"sineRange",id:"sineRange",min:"0",max:"100",value:t.sine,onChange:function(e){return n(Object(q.a)(Object(q.a)({},t),{},{sine:parseFloat(e.target.value)}))}}),Object(A.jsx)(ee,{classN:"waveIcon"})]}),Object(A.jsxs)("div",{className:"sliderContainer",children:[Object(A.jsx)("input",{type:"range",name:"squareRange",id:"squareRange",min:"0",max:"100",value:t.square,onChange:function(e){return n(Object(q.a)(Object(q.a)({},t),{},{square:parseFloat(e.target.value)}))}}),Object(A.jsx)(te,{classN:"waveIcon"})]}),Object(A.jsxs)("div",{className:"sliderContainer",children:[Object(A.jsx)("input",{type:"range",name:"triangleRange",id:"triangleRange",min:"0",max:"100",value:t.triangle,onChange:function(e){return n(Object(q.a)(Object(q.a)({},t),{},{triangle:parseFloat(e.target.value)}))}}),Object(A.jsx)(ne,{classN:"waveIcon"})]}),Object(A.jsxs)("div",{className:"sliderContainer",children:[Object(A.jsx)("input",{type:"range",name:"sawtoothRange",id:"sawtoothRange",min:"0",max:"100",value:t.sawtooth,onChange:function(e){return n(Object(q.a)(Object(q.a)({},t),{},{sawtooth:parseFloat(e.target.value)}))}}),Object(A.jsx)(ce,{classN:"waveIcon"})]})]}),Object(A.jsxs)("div",{className:"sliderCategory",children:[Object(A.jsx)("h5",{children:"Vibrato"}),Object(A.jsxs)("div",{className:"sliderContainer",children:[Object(A.jsx)("input",{type:"range",name:"vibratoGainSlider",id:"vibratoGainSlider",min:"0",max:"100",value:t.vibratoGain,onChange:function(e){return n(Object(q.a)(Object(q.a)({},t),{},{vibratoGain:parseFloat(e.target.value)}))}}),Object(A.jsx)("label",{htmlFor:"vibratoGainSlider",children:"Gain"})]}),Object(A.jsxs)("div",{className:"sliderContainer",children:[Object(A.jsx)("input",{type:"range",name:"vibratoFreqRange",id:"vibratoFreqRange",min:"0",max:"100",value:t.vibratoFreq,onChange:function(e){return n(Object(q.a)(Object(q.a)({},t),{},{vibratoFreq:parseFloat(e.target.value)}))}}),Object(A.jsx)("label",{htmlFor:"vibratoFreqRange",children:"Freq"})]})]})]}),Object(A.jsxs)("div",{className:"sliderCategory",children:[Object(A.jsx)("h5",{children:"Volumen"}),Object(A.jsxs)("div",{className:"sliderContainer",children:[Object(A.jsx)("input",{type:"range",name:"volumeInstrumentSlider",id:"volumeInstrumentSlider",min:"0",max:"100",value:t.volume,onChange:function(e){return n(Object(q.a)(Object(q.a)({},t),{},{volume:parseFloat(e.target.value)}))}}),Object(A.jsx)(L,{classN:"instrumentVolIcon"})]})]})]})})}var ae=function(){return function(e,t){var n=new WebSocket("ws://localhost:8080");e({type:O,payload:n})}},re=function(e){return function(t){t({type:x,payload:e})}},ie=function(e){return function(t,n){var c=n().chat.users;c.push(e),t({type:p,payload:c})}};n(42);function oe(e){var t=e.connectionState,n=Object(T.b)(),s=Object(c.useState)(5),a=Object(u.a)(s,2),r=a[0],i=a[1];return Object(c.useEffect)((function(){if(t===D)var e=5,c=setInterval((function(){i(e),-2===--e&&(clearInterval(c),n(ae()),i(5))}),1e3)}),[t,n]),Object(A.jsx)("div",{className:"reconnectContainer",children:t===B?Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)("h3",{children:"Connecting to server"}),Object(A.jsx)("p",{children:"please wait..."})]}):t===D?Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)("h3",{children:"Unable to connect to server"}),Object(A.jsxs)("p",{children:["trying to reconnect in ",r," seconds"]})]}):null})}n(43);function le(e,t){var n,c,s,a=JSON.parse(e.data);switch(a.status){case"connected":t((s=a.room,function(e){e({type:g,payload:s})})),a.users.forEach((function(e){t(ie(e)),t(M(e))}));break;case"newUser":t(ie(a.user)),t(M(a.user));break;case"userExit":t((c=a.user,function(e,t){var n=t().chat.users.filter((function(e){return e!==c}));e({type:w,payload:n})})),t((n=a.user,function(e,t){var c=t().waves,s=t().audioCtx.masterGain;c[n].analyser.disconnect(s),delete c[n],e({type:y,payload:c})}));break;case"message":if(a.message.hasOwnProperty("freq")){var r=a.message,i=r.freq,o=r.sine,l=r.square,u=r.sawtooth,j=r.triangle,d=r.vibratoGain,h=r.vibratoFrequency,b=r.instrumentVolume,v=r.isPlaying,f=a.user+i;t(v?W(f,i,o,l,u,j,d,h,b,a.user):J(f))}else{var m=a.message,O=m.drumpBuffersIndex,x=m.instrumentVolume,p=m.isPlaying,C=a.user+O;t(p?K(C,O,x,a.user):Y(C))}}}var ue=n(22),je=n.n(ue),de=n(26);n(45);function he(){var e=Object(c.useRef)(null),t=Object(T.c)((function(e){return e.waves})),n=Object(c.useRef)(0),s=Object(c.useRef)(0),a=Object(c.useRef)(null),r=Object(c.useRef)(null),i=Object(c.useState)([]),o=Object(u.a)(i,2),l=o[0],j=o[1],d=Object(c.useCallback)((function(){var t=document.getElementById("viewCon");n.current=t.offsetWidth,s.current=t.offsetHeight,e.current.width=n.current,e.current.height=s.current}),[]);Object(c.useEffect)((function(){return d(),window.addEventListener("resize",d),function(){window.removeEventListener("resize",d)}}),[d]),Object(c.useEffect)((function(){var e=Object.keys(t),n=Math.ceil(e.length/2),c=e.filter((function(e){return"local"!==e}));c.splice(n-1,0,"local"),j(c)}),[t]),Object(c.useEffect)((function(){a.current=e.current.getContext("2d")}),[]);var h=Object(c.useCallback)((function(){a.current.fillStyle="rgba(0,0,0,1)",a.current.fillRect(0,0,n.current,s.current),l.forEach((function(e,c){if(t[e]){var r=t[e],i=r.analyser,o=r.bufferLength,u=r.dataArr,j=r.color;i.getByteTimeDomainData(u);var d="local"===e?.7:.5,h=128*d,b=n.current-h;!function(e,t,n,c,s,r,i){a.current.strokeStyle=e,a.current.lineWidth=1,a.current.beginPath();for(var o=0;o<c;o++){var l=(s[o]-128)*i;l+=t;var u=(s[c-o]-128)*i;u+=n,0===o?a.current.moveTo(l,u):a.current.lineTo(l,u)}a.current.stroke(),a.current.strokeStyle=e,a.current.lineWidth=2,a.current.beginPath();for(var j=0;j<c;j++){var d=t+s[j]*r*Math.cos(2*Math.PI*j/c),h=n+s[j]*r*Math.sin(2*Math.PI*j/c);0===j?a.current.moveTo(d,h):a.current.lineTo(d,h)}a.current.stroke()}(j,b/l.length*c+(n.current-b/l.length*(l.length-1))/2,s.current/1.7,o,u,d,.5)}})),r.current=requestAnimationFrame(h)}),[t,l]);return Object(c.useEffect)((function(){return r.current=requestAnimationFrame(h),function(){return cancelAnimationFrame(r.current)}}),[h]),Object(A.jsx)("canvas",{ref:e,className:"canvas"})}var be=["f1","h1","k1","n1","o1","off1","p1","r1","s1","f2","h2","k2","n2","o2","off2","p2","r2","s2","f3","h3","k3","n3","o3","off3","p3","r3","s3"];function ve(){var e=Object(T.b)(),t=Object(c.useState)(50),n=Object(u.a)(t,2),s=n[0],a=n[1],r=Object(c.useState)(!1),i=Object(u.a)(r,2),o=i[0],h=i[1],b=Object(c.useState)([]),v=Object(u.a)(b,2),f=v[0],m=v[1],O=Object(c.useState)(!1),x=Object(u.a)(O,2),g=x[0],p=x[1],w=Object(c.useState)({sine:100,square:0,triangle:0,sawtooth:0,vibratoGain:0,vibratoFreq:0,volume:50}),y=Object(u.a)(w,2),E=y[0],k=y[1],G=Object(c.useCallback)((function(e){m((function(t){return t.includes(e.key.toLocaleLowerCase())?Object(l.a)(t):[].concat(Object(l.a)(t),[e.key.toLocaleLowerCase()])}))}),[]),L=Object(c.useCallback)((function(e){m((function(t){return t.filter((function(t){return t!==e.key.toLocaleLowerCase()}))}))}),[]);Object(c.useEffect)((function(){return window.addEventListener("keydown",G),window.addEventListener("keyup",L),function(){window.removeEventListener("keydown",G),window.removeEventListener("keyup",L)}}),[G,L]),Object(c.useEffect)((function(){var t,n;e((function(e){var t=new N;e({type:j,payload:t})})),e((function(e,t){var n=t().audioCtx.audioCtx,c=n.createGain();c.connect(n.destination),e({type:d,payload:c})})),e(M("local")),e((t=be,n=Z.length,function(){var e=Object(de.a)(je.a.mark((function e(c,s){var a,r,i,o,l,u,j,d;return je.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=s().audioCtx.audioCtx)){e.next=21;break}r=[],i=0;case 4:if(!(i<n)){e.next=20;break}return o=t[i%t.length],l="drumsSamples/".concat(o,".wav"),e.next=9,fetch(l);case 9:return u=e.sent,e.next=12,u.arrayBuffer();case 12:return j=e.sent,e.next=15,a.decodeAudioData(j);case 15:d=e.sent,r.push(d);case 17:i++,e.next=4;break;case 20:c({type:C,payload:r});case 21:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())),e(ae())}),[e]),Object(c.useEffect)((function(){var t;e((t=s/100,function(e,n){n().audioCtx.masterGain.gain.setValueAtTime(t,0)}))}),[s,e]);var I=Object(T.c)((function(e){return e.chat.connectionState})),z=Object(T.c)((function(e){return e.chat.ws}));return Object(c.useEffect)((function(){if(z){var t=!1;z.onerror=function(n){console.log("ws error"),e(re(D)),t=!0},z.onopen=function(t){console.log("connected"),e(re(X))},z.onmessage=function(t){return le(t,e)},z.onclose=function(n){t||(e(re(D)),e((function(e){e({type:S,payload:{ws:null,connectionState:B,room:"",users:[]}})})),e((function(e,t){var n=t().waves,c=t().audioCtx.masterGain;for(var s in n)"local"!==s&&(n[s].analyser.disconnect(c),delete n[s]);e({type:V,payload:n})})),console.log("close"))}}return function(){z&&z.close()}}),[z,e]),Object(A.jsxs)("div",{className:"chatMainContainer",children:[I!==X?Object(A.jsx)(oe,{connectionState:I}):null,Object(A.jsxs)("div",{className:"viewControlsContainer",id:"viewCon",children:[Object(A.jsx)(he,{}),Object(A.jsx)(R,{mainVolumen:s,setMainVolumen:a,drumsSelected:o,setDrumsSelected:h,setShowSettings:p}),Object(A.jsx)(se,{instrumentSettings:E,setInstrumentSettings:k,showSettings:g,drumsSelected:o})]}),Object(A.jsx)($,{keysPressed:f,drumsSelected:o,instrumentSettings:E})]})}function fe(e){var t=e.classN;return Object(A.jsxs)("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",xmlnsa:"http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/",viewBox:"0 0 177 177",className:t,children:[Object(A.jsx)("defs",{}),Object(A.jsxs)("g",{children:[Object(A.jsx)("circle",{cx:"88.5",cy:"88.5",r:"87"}),Object(A.jsx)("polygon",{points:"137,88.5 62,45.2 62,131.8 "})]})]})}n(46);function me(){return Object(A.jsxs)("div",{className:"HomeMainContainer",children:[Object(A.jsxs)("header",{className:"homeHeader",children:[Object(A.jsx)("img",{src:"/img/logo.svg",alt:"e.m. jam"}),Object(A.jsx)("h2",{children:"Real Time Musical Chat"})]}),Object(A.jsxs)("main",{className:"homeMain",children:[Object(A.jsxs)("ul",{children:[Object(A.jsx)("li",{children:"Drums and multi wave synthesizer"}),Object(A.jsx)("li",{children:"Five users per room"}),Object(A.jsx)("li",{children:"You can play with the interactive piano of the app or with your keyboard"}),Object(A.jsx)("li",{children:"Enjoy with the interactive visuals"})]}),Object(A.jsx)("button",{children:Object(A.jsxs)(i.b,{to:"/chat",children:[Object(A.jsx)("div",{className:"startContainer",children:Object(A.jsx)(fe,{classN:"startIcon"})}),Object(A.jsx)("span",{children:"START"})]})}),Object(A.jsx)("p",{className:"homeMessage",children:"Please put your device in landscape position for a better experience"})]})]})}var Oe=n(19),xe=n(28);var ge={ws:null,connectionState:B,room:"",users:[]};var pe=Object(Oe.b)({audioCtx:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case j:return Object(q.a)(Object(q.a)({},e),{},{audioCtx:t.payload});case d:return Object(q.a)(Object(q.a)({},e),{},{masterGain:t.payload});default:return e}},waves:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case h:var n=t.payload,c=n.userId,s=n.wave,a=Object(q.a)({},e);return a[c]=s,a;case y:case V:return Object(q.a)({},t.payload);default:return e}},notes:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case b:var n=t.payload,c=n.noteId,s=n.note;return e[c]=s,e;case f:var a=t.payload,r=a.drumId,i=a.drum;return e[r]=i,e;case v:case m:return t.payload;default:return e}},chat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ge,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:return Object(q.a)(Object(q.a)({},e),{},{ws:t.payload,connectionState:B});case x:return Object(q.a)(Object(q.a)({},e),{},{connectionState:t.payload});case g:return Object(q.a)(Object(q.a)({},e),{},{room:t.payload});case p:case w:return Object(q.a)(Object(q.a)({},e),{},{users:t.payload});case S:return Object(q.a)({},t.payload);default:return e}},drumsBuffer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return t.type===C?t.payload:e}});var we=function(){var e=Object(Oe.c)(pe,Object(Oe.a)(xe.a));return Object(A.jsx)(i.a,{children:Object(A.jsxs)(o.c,{children:[Object(A.jsx)(o.a,{path:"/chat",children:Object(A.jsx)(T.a,{store:e,children:Object(A.jsx)(ve,{})})}),Object(A.jsx)(o.a,{path:"/",children:Object(A.jsx)(me,{})})]})})},ye=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,50)).then((function(t){var n=t.getCLS,c=t.getFID,s=t.getFCP,a=t.getLCP,r=t.getTTFB;n(e),c(e),s(e),a(e),r(e)}))};r.a.render(Object(A.jsx)(s.a.StrictMode,{children:Object(A.jsx)(we,{})}),document.getElementById("root")),ye()}},[[49,1,2]]]);
//# sourceMappingURL=main.8ff5ba08.chunk.js.map